<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.85.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/evl/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/evl/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/evl/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/evl/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/evl/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/evl/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/evl/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/evl/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/evl/favicons/android-192x192.png" sizes="192x192">

<title>Visitor | </title><meta property="og:title" content="Visitor" />
<meta property="og:description" content="The EVL library provides multimethods that implement multiple dispatch. The implementation of the Visitor pattern is immediate. If you are not familiar with the pattern, you can have a look at the Wikipedia visitor pattern.
Implement the pattern requires some intrusive code and when we need to dispatch on the real type, we simply use the instanceof operator along with a downcast.
The classes used in the example are defined in the preliminaries." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/evl/docs/examples/visitor/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2021-01-04T12:03:39+01:00" />

<meta itemprop="name" content="Visitor">
<meta itemprop="description" content="The EVL library provides multimethods that implement multiple dispatch. The implementation of the Visitor pattern is immediate. If you are not familiar with the pattern, you can have a look at the Wikipedia visitor pattern.
Implement the pattern requires some intrusive code and when we need to dispatch on the real type, we simply use the instanceof operator along with a downcast.
The classes used in the example are defined in the preliminaries.">
<meta itemprop="dateModified" content="2021-01-04T12:03:39+01:00" />
<meta itemprop="wordCount" content="687">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Visitor"/>
<meta name="twitter:description" content="The EVL library provides multimethods that implement multiple dispatch. The implementation of the Visitor pattern is immediate. If you are not familiar with the pattern, you can have a look at the Wikipedia visitor pattern.
Implement the pattern requires some intrusive code and when we need to dispatch on the real type, we simply use the instanceof operator along with a downcast.
The classes used in the example are defined in the preliminaries."/>





<link rel="preload" href="/evl/scss/main.min.c2bc299561c13b716c290596e31271cf5bf0df216ba54fc62f4082b28487f946.css" as="style">
<link href="/evl/scss/main.min.c2bc299561c13b716c290596e31271cf5bf0df216ba54fc62f4082b28487f946.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<style>

	a {
		color: #b91515;
	}
	
	.btn-get-started {
		background: #5c5e5a;
		color: white;
	}
	
	.btn-use-it {
		background: #800000;
		color: white;
	}

</style>


    <title>Visitor | </title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/evl/">
		<span class="navbar-logo"><svg xmlns:ooo="http://xml.openoffice.org/svg/export" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.2" width="172" height="172" viewBox="7450 5250 4300 4300" preserveAspectRatio="xMidYMid" id="svg479" sodipodi:docname="Logo.svg" style="fill-rule:evenodd;stroke-width:28.22200012;stroke-linejoin:round" inkscape:version="0.92.4 (5da689c313, 2019-01-14)"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1017" id="namedview481" showgrid="false" units="px" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.2301357" inkscape:cx="81.259843" inkscape:cy="90.740159" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="svg479"/><defs class="ClipPathGroup" id="defs373"><clipPath id="presentation_clip_path" clipPathUnits="userSpaceOnUse"><rect x="7450" y="5250" width="4300" height="4300" id="rect370"/></clipPath></defs><defs id="defs382"><font id="EmbeddedFont_1" horiz-adv-x="2048" horiz-origin-x="0" horiz-origin-y="0" vert-origin-x="45" vert-origin-y="90" vert-adv-y="90"><font-face font-family="Lucida Console embedded" units-per-em="2048" font-weight="bold" font-style="normal" ascent="1614" descent="423" id="font-face375"/><missing-glyph horiz-adv-x="2048" d="M0 0H2047V2047H0V0z" id="missing-glyph377"/><glyph unicode="ε" horiz-adv-x="954" d="M1091 225V41C972-3 850-25 725-25 539-25 397 26 297 127 198 228 148 373 148 561c0 166 44 3e2 131 4e2 53 61 116 104 187 129 72 25 165 38 279 38 112 0 223-13 333-40V895c-135 32-244 48-329 48-222 0-341-92-356-275h625V483H393c9-107 42-188 1e2-242 59-54 149-81 271-81 103 0 212 22 327 65z" id="glyph379"/></font></defs><defs id="defs393"><font id="EmbeddedFont_2" horiz-adv-x="2048" horiz-origin-x="0" horiz-origin-y="0" vert-origin-x="45" vert-origin-y="90" vert-adv-y="90"><font-face font-family="Malgun Gothic embedded" units-per-em="2048" font-weight="bold" font-style="normal" ascent="2196" descent="503" id="font-face384"/><missing-glyph horiz-adv-x="2048" d="M0 0H2047V2047H0V0z" id="missing-glyph386"/><glyph unicode="v" horiz-adv-x="1086" d="M1096 1051 696 0H387L7 1051H307L514 369c19-65 31-123 36-174h5c5 50 17 106 36 169l213 687h292z" id="glyph388"/><glyph unicode="l" horiz-adv-x="266" d="M142 0V1555H420V0H142z" id="glyph390"/></font></defs><defs class="TextShapeIndex" id="defs397"><g ooo:slide="id1" ooo:id-list="id3 id4 id5" id="g395"/></defs><defs class="EmbeddedBulletChars" id="defs426"><g id="bullet-char-template(57356)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M580 1141l583-570L580 0-4 571z" id="path399" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(57354)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M8 1128H1137V0H8z" id="path402" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10146)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M174 0 602 739 174 1481 1456 739zM1358 739 309 1346 659 739z" id="path405" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10132)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M2015 739 1276 0H717l543 543H174v393h1086l-543 545h557z" id="path408" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10007)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="m0-2c-7 16-16 29-25 39l381 530c-94 256-141 385-141 387 0 25 13 38 40 38 9 0 21-2 34-5 21 4 42 12 65 25l27-13 111-251 280 301 64-25 24 25c21-10 41-24 62-43-36-69-87-143-152-222-1-1-60-68-176-2e2L774 223c0-27-21-55-63-84l16-20c-10-29-28-43-55-43-31 0-102 102-215 305L164-76c-22-34-53-51-92-51-42 0-63 17-64 51C1-67-2-52-2-32c0 9 1 19 2 30z" id="path411" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(10004)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M285-33C182-33 111 30 74 156 52 228 41 333 41 471c0 78 14 145 41 201 34 71 87 106 158 106 53 0 88-31 106-94l23-176c8-64 28-97 59-98l735 706c11 11 33 17 66 17 42 0 63-15 63-46V965c0-36-10-64-30-84L442 47C390-6 338-33 285-33z" id="path414" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(9679)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M813 0C632 0 489 54 383 161 276 268 223 411 223 592s53 324 160 431c106 107 249 161 430 161 179 0 323-54 432-161 108-107 162-251 162-431s-54-324-162-431C1136 54 992 0 813 0z" id="path417" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(8226)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="m346 457c-73 0-137 26-191 78-54 51-81 114-81 188 0 73 27 136 81 188s118 78 191 78 134-26 185-79c51-51 77-114 77-187 0-75-25-137-76-188-50-52-112-78-186-78z" id="path420" inkscape:connector-curvature="0"/></g><g id="bullet-char-template(8211)" transform="matrix(4.8828125e-4,0,0,-4.8828125e-4,0,0)"><path d="M-4 459H1135V606H-4z" id="path423" inkscape:connector-curvature="0"/></g></defs><defs class="TextEmbeddedBitmaps" id="defs428"/><g class="SlideGroup" id="g477"><g id="g475"><g id="id1" class="Slide" clip-path="url(#presentation_clip_path)"><g class="Page" id="g472"><g class="com.sun.star.drawing.CustomShape" id="g444"><g id="id3"><g id="g439"><defs id="defs435"><linearGradient id="gradient1" x1="8165" y1="4915" x2="11035" y2="9885" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#babdb6" id="stop430"/><stop offset="1" style="stop-color:#555753" id="stop432"/></linearGradient></defs><path style="fill:url(#gradient1)" d="M96e2 95e2H75e2V53e2h42e2v42e2z" id="path437" inkscape:connector-curvature="0"/></g><path d="M96e2 95e2H75e2V53e2h42e2v42e2z" id="path441" inkscape:connector-curvature="0" style="fill:none;stroke:#b91515;stroke-width:100;stroke-linejoin:miter"/></g></g><g class="com.sun.star.drawing.TextShape" id="g457"><g id="id4"><text class="TextShape" id="text454"><tspan class="TextParagraph" font-size="3387" font-weight="700" id="tspan452" style="font-weight:700;font-size:3387px;font-family:lucida console,monospace"><tspan class="TextPosition" x="7700" y="8296" id="tspan446"/><tspan class="TextPosition" x="7700" y="8296" id="tspan450"><tspan id="tspan448" style="fill:maroon;stroke:none">ε</tspan></tspan></tspan></text></g></g><g class="com.sun.star.drawing.TextShape" id="g470"><g id="id5"><text class="TextShape" id="text467"><tspan class="TextParagraph" font-size="2046" font-weight="700" id="tspan465" style="font-weight:700;font-size:2046px;font-family:malgun gothic,sans-serif"><tspan class="TextPosition" x="9700" y="8252" id="tspan459"/><tspan class="TextPosition" x="9700" y="8252" id="tspan463"><tspan id="tspan461" style="fill:#540000;stroke:none">vl</tspan></tspan></tspan></text></g></g></g></g></g></g></svg></span><span class="text-uppercase font-weight-bold"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/evl/docs/about/" ><span>What is EVL?</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/evl/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/ylegoc/evl" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="evldocs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/about/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">What is EVL?</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsabout">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/use/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">How to use EVL</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsuse">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/the-multimethods/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">The multimethods</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsthe-multimethods">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsbase-transform" href="/evl/docs/the-multimethods/base-transform/">The base transform</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsdimension-two" href="/evl/docs/the-multimethods/dimension-two/">In two dimensions</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsbest-match" href="/evl/docs/the-multimethods/best-match/">Best match</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodschange-comparator" href="/evl/docs/the-multimethods/change-comparator/">Change comparator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsambiguity-resolution" href="/evl/docs/the-multimethods/ambiguity-resolution/">Ambiguity resolution</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsthe-multimethodsmore-dimensions" href="/evl/docs/the-multimethods/more-dimensions/">More dimensions</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/theory/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Theory</a>
  </li>
  <ul>
    <li class="collapse " id="evldocstheory">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorytuple-distance" href="/evl/docs/theory/tuple-distance/">Tuple of types distance</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorydistance-comparators" href="/evl/docs/theory/distance-comparators/">Distance comparators</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorymultimethod-definition" href="/evl/docs/theory/multimethod-definition/">Multimethod definition</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheorysearch-best-match" href="/evl/docs/theory/search-best-match/">Search for the best match</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheoryinvoke" href="/evl/docs/theory/invoke/">Invoke with cache</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocstheoryasymmetric-vs-symmetric" href="/evl/docs/theory/asymmetric-vs-symmetric/">Asymmetric vs symmetric</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/more-features/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">More features</a>
  </li>
  <ul>
    <li class="collapse " id="evldocsmore-features">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuressuper-commands" href="/evl/docs/more-features/super-commands/">Super commands</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresinterfaces" href="/evl/docs/more-features/interfaces/">Interfaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresreturn-type-parameters" href="/evl/docs/more-features/return-type-parameters/">Return type and parameters</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresswitch" href="/evl/docs/more-features/switch/">Switch</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresopen-access" href="/evl/docs/more-features/open-access/">Open access</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featuresprotected-access" href="/evl/docs/more-features/protected-access/">Protected access</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featurescontrolled-extension" href="/evl/docs/more-features/controlled-extension/">Controlled extension</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsmore-featureserrors" href="/evl/docs/more-features/errors/">Errors</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/examples/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Examples</a>
  </li>
  <ul>
    <li class="collapse show" id="evldocsexamples">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplespreliminaries" href="/evl/docs/examples/preliminaries/">Preliminaries</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-evldocsexamplesvisitor" href="/evl/docs/examples/visitor/">Visitor</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesstateful-class" href="/evl/docs/examples/stateful-class/">Stateful class</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplescomposition" href="/evl/docs/examples/composition/">Composition</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesstate" href="/evl/docs/examples/state/">State</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplescomparator" href="/evl/docs/examples/comparator/">Comparator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesstrategy" href="/evl/docs/examples/strategy/">Strategy</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesfactory" href="/evl/docs/examples/factory/">Factory</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesobserver" href="/evl/docs/examples/observer/">Observer</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplesqueue" href="/evl/docs/examples/queue/">Queue</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplestostring" href="/evl/docs/examples/tostring/">ToString</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-evldocsexamplestreewalker" href="/evl/docs/examples/treewalker/">Tree walker</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/evl/docs/why/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Why use EVL?</a>
  </li>
  <ul>
    <li class="collapse " id="evldocswhy">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            









<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#simple-dispatch">Simple dispatch</a></li>
        <li><a href="#multiple-dispatch">Multiple dispatch</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/evl/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="/evl/docs/examples/">Examples</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/evl/docs/examples/visitor/">Visitor</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Visitor</h1>
	
	<p>The EVL library provides multimethods that implement multiple dispatch. The implementation of the <strong>Visitor</strong> pattern is immediate.
If you are not familiar with the pattern, you can have a look at the Wikipedia <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor pattern</a>.</p>
<p>Implement the pattern requires some intrusive code and when we need to dispatch on the real type, we simply use the <em>instanceof</em> operator along with a downcast.</p>
<p>The classes used in the example are defined in the <a href="/docs/examples/preliminaries/">preliminaries</a>.
First we define a list of <em>Toy</em> objects that we will traverse:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ArrayList&lt;Toy&gt; toys = <span style="color:#00a">new</span> ArrayList&lt;Toy&gt;();
toys.<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Car(<span style="color:#a50">&#34;red&#34;</span>));
toys.<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Doll(10));
</code></pre></div><h3 id="simple-dispatch">Simple dispatch</h3>
<p>If you need to traverse the list and process the <em>Toy</em> objects, you will often write:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#00a">for</span> (Toy toy : toys) {
	
	<span style="color:#00a">if</span> (toy <span style="color:#00a">instanceof</span> Car) {
		Car car = (Car)toy;
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Car with color &#34;</span> + car.<span style="color:#1e90ff">getColor</span>());
	}
	
	<span style="color:#00a">if</span> (toy <span style="color:#00a">instanceof</span> Doll) {
		Doll doll = (Doll)toy;
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Doll with height &#34;</span> + doll.<span style="color:#1e90ff">getHeight</span>());
	}
	
}
</code></pre></div><p>The downcast enables to access to the specific methods of <em>Car</em> and <em>Doll</em>. However this code is not extensible. How to do if we need to process a <em>Game</em> object? Modify the loop?</p>
<p>Replace the <em>instanceof</em> operator is easily done by using a multimethod so that the <strong>Visitor</strong> becomes useless.
Here is the code with a multimethod:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Method1&lt;Void&gt; play = <span style="color:#00a">new</span> Method1&lt;Void&gt;().<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Cases() {
			
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Car car) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Car with color &#34;</span> + car.<span style="color:#1e90ff">getColor</span>());
	}
	
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Doll doll) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Doll with height &#34;</span> + doll.<span style="color:#1e90ff">getHeight</span>());
	}

});

<span style="color:#00a">for</span> (Toy toy : toys) {
	play.<span style="color:#1e90ff">invoke</span>(toy);
}
</code></pre></div><p>And if you need to add a new case for a <em>Game</em> object, this is naturally done:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">play.<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Cases() {
			
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Game game) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Game with players &#34;</span> + game.<span style="color:#1e90ff">getPlayers</span>());
	}
	
});
</code></pre></div><p>Adding a new case only depends on the visibility of the multimethod. If it is global, new cases can be added anywhere and the loop does not need to be extended.</p>
<h3 id="multiple-dispatch">Multiple dispatch</h3>
<p>Now we want to refine the dispatch by taking into account the status of the person playing with the toys. The status is represented by the <em>Person</em> class hierarchy including <em>Kid</em>, <em>Teen</em> and <em>Adult</em>.</p>
<p>We define a multimethod of dimension two, first dimension being the <em>Person</em> and second the <em>Toy</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Method2&lt;Void&gt; play = <span style="color:#00a">new</span> Method2&lt;Void&gt;().<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Cases() {
				
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Kid kid, Car car) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(kid.<span style="color:#1e90ff">getAge</span>() + <span style="color:#a50">&#34; years old kid plays with car with color &#34;</span> + car.<span style="color:#1e90ff">getColor</span>());
	}
	
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Kid kid, Doll doll) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(kid.<span style="color:#1e90ff">getAge</span>() + <span style="color:#a50">&#34; years old kid plays with doll with height &#34;</span> + doll.<span style="color:#1e90ff">getHeight</span>());
	}
	
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Teen teen, Game game) {
		System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(teen.<span style="color:#1e90ff">getSex</span>() + <span style="color:#a50">&#34; teen plays with game with players &#34;</span> + game.<span style="color:#1e90ff">getPlayers</span>());
	}
	
});
</code></pre></div><p>Let&rsquo;s play with two persons:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Person[] persons = {<span style="color:#00a">new</span> Kid(5), <span style="color:#00a">new</span> Teen(Teen.<span style="color:#1e90ff">Sex</span>.<span style="color:#1e90ff">BOY</span>)};

<span style="color:#00a">for</span> (Person person : persons) {
	<span style="color:#00a">for</span> (Toy toy : toys) {
		<span style="color:#00a">try</span> {
			play.<span style="color:#1e90ff">invoke</span>(person, toy);
		}
		<span style="color:#00a">catch</span> (Throwable e) {
			System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Toy cannot be played&#34;</span>);
		}
	}
}
</code></pre></div><p>This time we needed to catch the exception when there is no compatible method. This happened for the couples (<em>Kid</em>, <em>Game</em>), (<em>Teen</em>, <em>Car</em>) and (<em>Teen</em>, <em>Doll</em>).
The exception that is thrown is an instance of <em>NoMatchingMethodException</em>. If you want to define your own exception and manage the errors yourself, this is also feasible:</p>
<p>We suppose that you defined the <em>ToyCannotBePlayedException</em> class.</p>
<p>We add a new match method that covers all the error cases:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">play.<span style="color:#1e90ff">add</span>(<span style="color:#00a">new</span> Cases() {
				
	<span style="color:#0aa">void</span> <span style="color:#0a0">match</span>(Person person, Toy toy) <span style="color:#00a">throws</span> ToyCannotBePlayedException {
		<span style="color:#00a">throw</span> <span style="color:#00a">new</span> ToyCannotBePlayedException();
	}
});
</code></pre></div><p>We catch it in the loop:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#00a">for</span> (Person person : persons) {
	<span style="color:#00a">for</span> (Toy toy : toys) {
		<span style="color:#00a">try</span> {
			play.<span style="color:#1e90ff">invoke</span>(person, toy);
		}
		<span style="color:#00a">catch</span> (ToyCannotBePlayedException e) {
			System.<span style="color:#1e90ff">out</span>.<span style="color:#1e90ff">println</span>(<span style="color:#a50">&#34;Toy cannot be played by any person&#34;</span>);
		}
		<span style="color:#00a">catch</span> (Throwable e) {}
	}
}
</code></pre></div><p>We could have defined a match method for each error case but that is not necessary. The multimethod dispatches on the most specific couple and it is enough to define a single match method on (<em>Person</em>, <em>Toy</em>).
The couple (<em>Kid</em>, <em>Car</em>) is compatible with (<em>Person</em>, <em>Toy</em>) but there exists a perfect match method that is thus applied. However there is no perfect match for (<em>Kid</em>, <em>Game</em>) but (<em>Person</em>, <em>Toy</em>) is compatible and is thus applied.
For more details, see <a href="/docs/the-multimethods/best-match/">best match</a> and <a href="/docs/theory/search-best-match/">search for the best match</a>.</p>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified January 4, 2021: <a  href="/commit/2efed3deb499da695ecc484d2660f2301322c803">Doc (2efed3d)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/ylegoc/evl">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 The EVL Authors All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/evl/js/main.min.9bf7aaf346c408e3f77ec60207f33b92923a9e8f34edb7aee06a12ce9a06e469.js" integrity="sha256-m/eq80bECOP3fsYCB/M7kpI6no807beu4GoSzpoG5Gk=" crossorigin="anonymous"></script>



  </body>
</html>